[toc]



## 分层结构、协议、接口、服务

- 分层基本原则
  -  各层相互独立，每层只实现一种相对功能
  - 每层之间间隔清晰，易于理解，每层之间交流少
  - 每层采用最合适的技术实现
  - **下层为上层提供服务，上层要求服务**

- 正式认识分层结构

   1.实体：第n层中的实体称为**n层实体**，同一层的称为**对等实体**

   2.协议：为实现对等实体的数交换而建立的规则、标准或者约定	

   - 语法：规定传输的数据的格式
   - 语义：规定所要完成的功能
   - 同步：规定操作的顺序 

  3.接口：上层使用下层服务的入口称为接口（**仅仅在相邻层之间有接口**）

  <img src="/Users/fu00/Library/Application Support/typora-user-images/image-20210328212750239.png" alt="image-20210328212750239" style="zoom:40%;" />

  ​				                       <font size=6>上四层:端到端    下三层:点到点 </font>

  

  

  ### 应用层

  ### 表示层

  - 数据的格式变换（二进制转化成图片等等）
  - 数据的解密与加密
  - 数据的压缩与恢复

  ### 会话层

  - 建立、管理、终止会话
  - 通信失效的时候从**校验点/同步点**继续恢复通信

  ### 传输层

  - 可靠传输和不可靠传输
  - 差错控制
  - 流量控制
  - 复用和分用

  ### 网络层

  - 路由选择

  - 差错控制
  - 流量控制
  - 拥塞控制

   ### 数据链路层

  - 成帧（定义帧的开始和结束）
  - 差错控制
  - 流量控制
  - 访问（接入）控制 **控制对信道的访问**

  ### 物理层

  - 定义接口特性
  - 定义传输模式（单工、半双工、全双工）
  - 定义传输速率
  - 比特同步
  - 比特编码

# 物理层

目前看笔记中好像没啥可以整理的，后续再仔细整理

### 奈式准则（Nyquist）

是在**理想状态下**得出的结论
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626222053679.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 香农公式（Shannon）

是在**有噪声的信道中**得出的结论
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626225409541.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200626225547833.png?shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTA2NzYwMw==,size_16,color_FFFFFF,t_70)

### 基带信号与宽带信号

近距离基带，远距离宽带

### 编码与调制

数据编码成**数字**信号，数据调制成**模拟**信号

#### 编码

归零编码：一个码元内归零          非归零编码：高1低0          反向不归零编码：信号翻转为0，不翻转为1 

曼彻斯特编码：将一个码元分为两个间隔（前后不同），传输速率是编制速率的0.5   差分曼彻斯特：同1异0 （前半码元和前一部分的后半码元是否相同）

4b/5b编码：4个比特中插入1个比特，用来打断一连串的1或0，编码效率80%。 

#### 调制与解调

调制（调幅、调频、调相  ）：发送端将数字信号转化为模拟信号 解调：接受端将模拟信号转化数字信号

### 传输介质

- 导向性传输介质
  - 双绞线：铜导线相互绞合减弱电磁影响
  - 同轴电缆：分为基带型和宽带型，抗干扰能力较强
  - 光纤：带宽非常大，光线入射角够大，产生全反射（损耗非常小）
    - 多模光纤：反射，近距离
    - 单模光纤：不反射（输入和输出基本相同），损耗小、远距离
- 非导向性介质 ：无线电波、微波、红外线

### 中继器

再生数字信号

中继器两端：

- 速率相同
- 协议相同

### 集线器（多口中继器）

- 不能分割冲突域，平分带宽
- 共享式设备

5-4-3规则：5个网段、4个中继器、3个主机

# 数据链路层

 

### 透明传输：不管所传的数据是什么样的比特组成，都能在数据链路层上传输。

1. 字符计数法：第一个字节记录帧内有多少个字符
2. 字符填充法，在与开始子符和结束字符相同的字符中添加转义字符，防止错误开始与停止
3. 零比特填充法：5110，每五个1填充一个0 
4. 违规编码法：用编码中不会用到的字符来做开始与结束 

物理层与链路层的编码不同：一个是针对单个比特，一个是针对一组比特

### 为什么要在数据链路层进行差错控制？

因为错误可以尽早发现，不会让一个错误的数据包发送了很长时间到达最终目的地之后才被发现，从而**导致网络资源的浪费**

### 奇偶校验码：50%检错能力

### 循环冗余码：（不是很懂）

![image-20210426224555987](/Users/fu00/Library/Application Support/typora-user-images/image-20210426224555987.png)

冗余码=FCS=crc检验码

### 海明校验码（计组中也有）

- 发现双比特错，纠正单比特错
- 2^r >= k+r+1

### 可靠传输：发送端发啥，接收端收啥

### 流量控制

- 链路层 点到点 手段：收不下就不发送确认

- 传输层 端到端 手段：接收端给发送端一个窗口公告

### 停止等待协议的特点

发送端每发送一个帧都要等接收方正确收到后返回一个确认帧后再继续发下一个帧

1. 简单
2. 信道利用率低。大部分时间数据都在路上，发送方很长时间闲置，资源浪费
3. 特殊的滑动窗口（窗口大小为1）
4. 超时后启动重传

### 选择重传协议（SR ）

#### 发送方

1. 上层的调用：上层传来要发送的数据时，发送方先检查滑动窗口有没有满，没满往里面添加，满了的话做一个缓存，等滑动窗口未满时再添加进滑动窗口
2. 收到ACK后，滑动窗口移动到具有最小序号的未确认帧处，然后发送窗口内未发送的帧
3. 每个帧都有个计时器，超时后重传该帧

#### 接收方

1. 来者不拒，失序的帧被缓存起来，直到该帧之前的帧都收到了，才交付给上层然后再向前移动滑动窗口。
2. 只要收到了滑动窗口内的帧就返回ACK 

⚠️注意：

1. 发送窗口最好等于接收窗口
2. 发送窗口与接收窗口长度之和小于编号数量
3. 只重传出错帧
4. 接收方也有缓存

### 后退n帧协议（GBN）

#### 发送方

1. 上层的调用：上层传来要发送的数据时，发送方先检查滑动窗口有没有满，没满往里面添加，满了的话做一个缓存，等滑动窗口未满时再添加进滑动窗口
2. 收到了一个ACK：采用**累计确认**，收到该帧的确认帧代表该帧和之前帧全部正确收到。
3. 超时事件：如果定时器检测到超时，发送方重传超时期间发送的所有帧。
4. 发送窗口为2^n-1（n为采用n比特编码），防止分不出旧帧和新帧

#### 接收方

1. 正确收到一个n帧发送一个ACKn给发送方
2. 维护下一个应该接受到的帧的信息（如果是其他的帧则丢弃继续等待直到收到正确的帧），简单来说只按顺序接受帧
3. 接受窗口为1

#### GBN协议性能分析

一旦收到错误的帧，后面接受的帧全部丢弃，性能比SR协议低。

### 介质访问控制 （CSMA/CD    CSMA/CA）

- 静态划分信道：

  1. 频分多路复用FDM
  2. 时分多路复用TDM    （统计时分复用 STDM：按需分配时隙）    
  3. 波分多路复用WDM （光的频分多路复用）
  4. 码分多路复用CDM （码分多址CDMA是CDM的一种方式）

- 动态分配信道：

  - 轮询访问介质访问控制： 令牌传递协议

  - 随机访问介质访问控制：

    1. ALOHA协议：想发就发

    2. CSMA 载波监听多路访问协议：

       ​	CS：监听  MA：多点接入

       ​	协议思想：发送帧之前，监听信道

       ​	![image-20210504222251902](/Users/fu00/Library/Application Support/typora-user-images/image-20210504222251902.png)

    3. **CSMA/CD**（总线式，有线网）

       CSMA载波监听多点接入     CD碰撞检测

       协议思想：发送帧之前，监听信道（空闲时边发送边监听，如果碰撞，停止发送）

       <img src="/Users/fu00/Library/Application Support/typora-user-images/image-20210505224853216.png" alt="image-20210505224853216" style="zoom:50%;" />

       最小帧长 = 2 * 总线传播时延 * 数据传播时延

    4. **CSDM/CA**（无线局域网）

    CA碰撞避免

    ![image-20210505231238207](/Users/fu00/Library/Application Support/typora-user-images/image-20210505231238207.png)

    

### 局域网（常用总线型拓扑）

 特点：范围小，延迟小，可靠率高，共享信道，多采用分布式控制和广播式通信，可以进行广播和组播

介质访问方法：CSMA/CD ，令牌总线，令牌环

#### 以太网（属于局域网）

特点：无连接、不可靠

### 广域网

特点：范围大

### PPP协议

PPP协议特点：（简单，提供不可靠的数据报服务，检错，无纠错 不使用序号和确认机制），面向字节

1. 简单
2. 封装成帧
3. 透明传输
4. 支持多种网络层协议
5. 支持多种类型链路
6. 差错检测（循环冗余码）
7. 检测连接状态
8. 最大传送单元
9. 网络层地址协商 ：知道相互的网络层地址
10. 数据压缩协商

协议工作流程（之后再说，不知道重不重要）

1. 用LCP协议建立物理链路连接
2. 建立完物理链路连接，使用NCP配置网络cheng

### HDLC协议

特点：可靠（消耗资源大），面向比特